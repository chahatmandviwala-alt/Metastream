<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Wallet Connect</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{
    --bg: #fafbfc;
    --text: #0f172a;
    --muted:#475569;
    --border:#e2e8f0;
    --panel:#ffffff;
    --accent:#357CBA;
    --mono: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace;
    --sans: system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Noto Sans";
    --radius: 10px;
  }

  *{ box-sizing:border-box; }

  html, body{ width:100%; overflow-x:hidden; }
  .section, .codebox, textarea, input{ max-width:100%; }
  body{ margin:0; font-family:var(--sans); background:var(--bg); color:var(--text); min-height: 100vh; display: flex; flex-direction: column;   }
  .wrap{ max-width:600px; margin:0 auto; padding:24px 16px; display:flex; flex-direction:column; justify-content:flex-start; width:100%; }
  h1{ font-size:1.15rem; margin:4px 0 6px 0; }
  .section {
    background:var(--panel);
    border:3px solid var(--border);
    border-radius:var(--radius);
    padding:16px;
    margin-bottom:2px;
    display: flex;
	font-size:14px;
    flex-direction: column;
    align-self: stretch;
    width: 100%;      /* ensure blocks stay within their column */
    max-width: 100%;  /* guard against overflow */
  }
  
  .muted{ color:var(--muted); font-size:.95rem; }
  label{ display:block; font-weight:600; margin:6px 0 6px; }
input[type=text], input[type=password], textarea{
  width:100%;
  padding:10px 12px;
  border:1px solid var(--border);
  border-radius:8px;
  background:transparent;
  color:inherit;
  outline:none;
}

input[type=text]:focus, input[type=password]:focus, textarea:focus{
  border-color:var(--accent);
}

  textarea{ min-height:100px; resize:vertical; margin-bottom:6px; }
  .row{ display:grid; grid-template-columns:1fr 1fr; gap:4px; }
  @media (max-width:640px){ .row{ grid-template-columns:1fr; } }
  .btn{
    display:inline-block; padding:8px 14px; border-radius:8px; border:1px solid var(--accent);
    color:#fff; background:var(--accent); font-weight:600; font-size:12px; cursor:pointer; margin-top:8px;
  }
  .btn.secondary{ background:transparent; color:var(--accent); }
  .mono{ font-family:var(--mono); word-break:break-all; }
  .codebox{
    border:1px solid var(--border); border-radius:8px; padding:10px 12px; background:transparent;
    flex-grow: 1;
  }
  .flex{ display:flex; gap:12px; flex-wrap:wrap; }
  #qr {
    max-width: 100%;
    height: 150px;
    object-fit: contain;
    border:1px solid var(--border); border-radius:8px; background:#fff;
  }

  /* Layout container */
  .grid-container {
    display: grid;
    gap: 4px;
    grid-template-columns: 1fr; /* Single column on small screens */
    align-items: stretch;
  }
  @media (min-width: 640px) {
    .grid-container {
      grid-template-columns: 1fr 1fr;
      align-items: stretch;
    }
    /* Make the top "Import Seedphrase" block span full width */
    #input-block {
      grid-column: 1 / -1;
    }
  }

  #input-block .bottom-controls {
    display: flex;
    flex-direction: column;
    align-items: flex-start;
  }
  
  #input-block {
    justify-content: flex-start;
  }
  
  .stack{
    display:grid;
    grid-template-columns: 1fr;
    gap: 6px;
  }
  
  .centered-header {
    text-align: center;
    margin-bottom: 14px;
  }
  .centered-header h1 {
    margin-bottom: 8px;
  }
  .subheading {
    color: var(--muted);
    font-size: 0.9rem;
    margin: 0;
  }
  
  .footnote {
    font-size: 0.8rem;
    color: #008000;
    margin-top: 2px;
    margin-bottom: 0;
  }
  

    /* hidden utility class for conditional sections */
  .hidden { display: none; }
  
#qr-footnote {
  width: 100%;
  text-align: center;
  white-space: normal;
  overflow-wrap: anywhere;
  display: block;
  margin-top: 0px;
  grid-column: 1 / -1;
}

#ur {
  font-size: 0.75rem; /* adjust as needed */
  line-height: 1.2;
}

#ur-section,
#qr-section {
  min-height: 200px;   /* adjust as needed */
}

.row-controls{
  display: grid;
  grid-template-columns: 1fr 1fr auto;
  gap: 16px;
  align-items: end;
}

.confirm-wrap{
  align-self: end;
}

.confirm-wrap button{
  height: 36px;
  padding: 0 16px;
  margin-top: 0; /* align with inputs */
}

@media (max-width: 520px){
  .row-controls{
    grid-template-columns: 1fr;
    gap: 10px;
  }
  .confirm-wrap button{
    width: 100%;
  }
}

#qr-footnote.hidden{
  display: none !important;
}
    .warning{
      margin-top: 8px;
	  margin-bottom: 0px;
      padding: 6px;
      border-radius: 8px;
      border: 1px solid rgba(239, 68, 68, 0.25);
      background: rgba(239, 68, 68, 0.06);
      color: #b91c1c;
      font-size: 0.65rem;
      line-height: 1.1;
    }
	
	.label-with-info{
  display: inline-flex;
  align-items: center;
  gap: 6px;
}

/* Info icon */
.info-icon{
  position: relative;
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  font-size: 10px;
  font-weight: 500;
  color: var(--muted);
  border: 1px solid var(--border);
  border-radius: 50%;
  cursor: help;
  line-height: 1;
}

/* Tooltip */
.info-icon .tooltip{
  position: absolute;
  bottom: calc(100% + 8px);
  left: 50%;
  transform: translateX(-50%);
  min-width: 260px;
  max-width: 320px;
  padding: 10px 12px;
  background: var(--panel);
  color: var(--text);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-size: 0.7rem;
  line-height: 1.35;
  box-shadow: 0 8px 24px rgba(0,0,0,0.08);
  opacity: 0;
  pointer-events: none;
  transition: opacity 120ms ease, transform 120ms ease;
  z-index: 10;
}

/* Tooltip arrow */
.info-icon .tooltip::after{
  content: "";
  position: absolute;
  top: 100%;
  left: 50%;
  transform: translateX(-50%);
  border-width: 6px;
  border-style: solid;
  border-color: var(--border) transparent transparent transparent;
}

/* Show on hover / focus */
.info-icon:hover .tooltip,
.info-icon:focus .tooltip{
  opacity: 1;
  transform: translateX(-50%) translateY(-2px);
}

/* Code styling inside tooltip */
.tooltip code{
  font-family: var(--mono);
  font-size: 0.72rem;
  background: rgba(2,6,23,0.05);
  padding: 2px 4px;
  border-radius: 4px;
}

/* Passphrase label row + Show/Hide toggle */
.field { width: 100%; }

.label-row{
  width:100%;
  display:flex;
  align-items:baseline;
  justify-content:space-between;
  gap:12px;
  margin-bottom:6px;
}

.field-label{
  margin: 6px 0 0;
}

.text-toggle{
  font-size:11px;
  padding:2px 6px;
  border:1px solid var(--border);
  border-radius:6px;
  background:transparent;
  color:var(--muted);
  cursor:pointer;
  white-space:nowrap;
}

.text-toggle:hover{
  border-color: var(--accent);
  color: var(--accent);
}



</style>
</head>
<body>
  <div class="wrap">
    <header class="centered-header">
      <h1>Connect Wallet</h1>
      <p class="subheading">Connect wallet to Metamask or Rabby as a hardware wallet</p>
    </header>

    <div class="grid-container">
      <!-- TOP: full-width input block -->
      <section class="section" id="input-block">
        <div class="field">
          <div class="label-row">
            <label for="mnemonic" class="field-label">Seed phrase</label>
            <button type="button" id="toggleMnemonic" class="text-toggle">Show</button>
          </div>

          <textarea
            id="mnemonic"
            placeholder="Enter your 12/15/18/21/24 word mnemonic seed phrase"
            data-hidden="true"
          ></textarea>
        </div>
		
<div class="row-controls">
<div class="field">
  <div class="label-row">
    <label for="passphrase" class="field-label">
      Passphrase
      <span class="info-icon" tabindex="0" aria-label="Passphrase information">
        ⓘ
        <span class="tooltip">
          Leave it blank if you do not know what a passphrase is.
        </span>
      </span>
    </label>

    <button type="button" id="togglePassphrase" class="text-toggle">Show</button>
  </div>

  <input id="passphrase" type="password" placeholder="Enter passphrase (optional)" />
</div>


  <div>
    <label class="label-with-info">
  Derivation path
  <span class="info-icon" tabindex="0" aria-label="Derivation path information">
    ⓘ
    <span class="tooltip">
      Default path for connecting Ethereum wallets is <code>m/44'/60'/0'</code>.
      Do not change if you do not know what a derivation path is.
    </span>
  </span>
</label>

    <input id="path" type="text" value="m/44'/60'/0'" />
  </div>

  <div class="confirm-wrap">
    <label>&nbsp;</label>
    <button id="go" class="btn">Confirm</button>
  </div>
</div>

<div id="err" style="font-size:10px; color:gray; margin-top:4px;"></div>
      </section>

      <!-- UR section: appears below input block after generation -->
      <section class="section hidden" id="ur-section">
        <div id="ur" class="codebox mono"></div>
        <div class="flex">
          <button id="copy" class="btn">Copy UR</button>
          <button id="saveTxt" class="btn secondary">Download ur.txt</button>
        </div>
      </section>

      <!-- QR section: appears next to UR on wide screens, below on narrow screens -->
      <section class="section hidden" id="qr-section" style="align-items: center;">
        <img id="qr" />
        <div class="flex">
          <button id="savePng" class="btn secondary">Download QR (PNG)</button>
        </div>
      </section>
	  
	  <!-- New footnote -->
      <p id="qr-footnote" class="footnote hidden"> Connect to Metamask/Rabby: Add hardware wallet  >  Select QR-based/Keystone  >  Scan the QR. </p>
    </div>
	<div id="security-warning" class="warning">
  <strong>Security Note:</strong> Use this tool on an air-gapped machine for maximum security.
</div>
  </div>

<script>
  async function gen() {
    setErr(''); 
    set('ur',''); 
    document.getElementById('qr').src = '';

    // hide UR + QR sections at the start of each generation attempt
    document.getElementById('ur-section').classList.add('hidden');
    document.getElementById('qr-section').classList.add('hidden');
	document.getElementById('qr-footnote').classList.add('hidden');
	document.getElementById('security-warning').classList.add('hidden');

    try {
      const mnemonic = get('mnemonic').trim();
      if (!mnemonic) {
        setErr('Please enter your seedphrase before confirming.');
        return;
      }

      const body = {
        mnemonic:  mnemonic,
        passphrase:get('passphrase'),
        path:      get('path').trim()
      };

      const resp = await fetch('/api/gen', {
        method: 'POST',
        headers: { 'content-type': 'application/json' },
        body: JSON.stringify(body),
      });
      const data = await resp.json();
      if (!resp.ok) throw new Error(data.error || 'Unknown error');

      
	  // We no longer display path / FP details, only UR + QR
      set('ur', data.ur);
      document.getElementById('qr').src = data.qrDataUrl;
      window.__lastUR = data.ur; 
      window.__lastQR = data.qrDataUrl;

      // SECURITY: clear sensitive inputs after successful generation
      document.getElementById('mnemonic').value = '';
      // Optional: also clear passphrase if you want
      // document.getElementById('passphrase').value = '';

      // Show UR + QR sections only after successful generation
      document.getElementById('ur-section').classList.remove('hidden');
      document.getElementById('qr-section').classList.remove('hidden');
	  if (data.qrDataUrl) { document.getElementById('qr-footnote').classList.remove('hidden'); }

    } catch (e) { 
      setErr(e.message || String(e)); 
    }
  }
  function set(id, v){ document.getElementById(id).textContent = v; }
  function get(id){ return document.getElementById(id).value; }
  function setErr(t){ document.getElementById('err').textContent = t; }
  function attachButtonToggle(inputId, buttonId) {
  const input = document.getElementById(inputId);
  const btn = document.getElementById(buttonId);
  if (!input || !btn) return;

  btn.addEventListener("click", () => {
    const visible = input.type === "text";
    input.type = visible ? "password" : "text";
    btn.textContent = visible ? "Show" : "Hide";
  });
}

  function attachTextareaToggle(textareaId, buttonId) {
    const ta = document.getElementById(textareaId);
    const btn = document.getElementById(buttonId);
    if (!ta || !btn) return;

    // start hidden
    ta.style.webkitTextSecurity = "disc";

    btn.addEventListener("click", () => {
      const hidden = ta.style.webkitTextSecurity === "disc";
      ta.style.webkitTextSecurity = hidden ? "none" : "disc";
      btn.textContent = hidden ? "Hide" : "Show";
    });
  }

  attachButtonToggle("passphrase", "togglePassphrase");
  attachTextareaToggle("mnemonic", "toggleMnemonic");


  document.getElementById('go').addEventListener('click', gen);
  document.getElementById('copy').addEventListener('click', async () => {
    if (!window.__lastUR) return;
    try { await navigator.clipboard.writeText(window.__lastUR); alert('UR copied'); }
    catch { alert('Clipboard blocked by browser'); }
  });
  document.getElementById('saveTxt').addEventListener('click', () => {
    if (!window.__lastUR) return;
    const a = document.createElement('a');
    a.href = 'data:text/plain;charset=utf-8,' + encodeURIComponent(window.__lastUR);
    a.download = 'ur.txt'; a.click();
  });
  document.getElementById('savePng').addEventListener('click', () => {
    if (!window.__lastQR) return;
    const a = document.createElement('a');
    a.href = window.__lastQR; a.download = 'ur.png'; a.click();
  });
</script>
</body>
</html>
