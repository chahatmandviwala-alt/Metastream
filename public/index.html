<!DOCTYPE html>

<html lang="en">
<head>

<script>
(function () {
  // Only apply fixes when running inside Android WebView assets
  const isAndroidAsset =
    location.protocol === "file:" &&
    location.pathname.includes("/android_asset/");

  if (!isAndroidAsset) return;

  // Force relative URLs like "tabs/xyz.html" to resolve to:
  // file:///android_asset/tabs/xyz.html
  const base = document.createElement("base");
  base.href = "file:///android_asset/";
  document.head.appendChild(base);
})();
</script>


<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>M&thinsp;E&thinsp;T&thinsp;A&thinsp;S&thinsp;T&thinsp;R&thinsp;E&thinsp;A&thinsp;M</title>
<style>
    :root {
      --sidebar-expanded: 240px;
      --sidebar-collapsed: 63px;
      --bg: #0f172a;        /* slate-900-ish */
      --bg2: #111827;       /* slightly lighter */
      --hover: #1f2937;     /* slate-800-ish */
      --text: #e5e7eb;      /* gray-200 */
      --muted: #9ca3af;     /* gray-400 */
      --accent: #3b82f6;    /* blue-500 */
    }

    * { box-sizing: border-box; }

    body {
      margin: 0;
      font-family: Arial, Helvetica, sans-serif;
      height: 100vh;
      display: flex;
      background: #f3f4f6;
    }

    /* Sidebar */
    .sidebar {
      width: var(--sidebar-expanded);
      background: var(--bg);
      color: var(--text);
	  overflow-x: hidden;
      display: flex;
      flex-direction: column;
      transition: width 180ms ease;
      border-right: 1px solid rgba(255,255,255,0.06);
    }

    .sidebar.collapsed {
      width: var(--sidebar-collapsed);
	  overflow-x: hidden;
    }

    .sidebar-header {
      height: 56px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 12px;
      background: var(--bg2);
      border-bottom: 1px solid rgba(255,255,255,0.06);
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 10px;
      min-width: 0;
    }

    .brand-title {
      font-weight: 700;
      font-size: 14px;
      letter-spacing: 0.2px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: opacity 120ms ease;
    }

    .sidebar.collapsed .brand-title {
      opacity: 0;
      width: 0;
    }

    .toggle-btn {
      appearance: none;
      border: 0;
      background: transparent;
      color: var(--text);
      cursor: pointer;
      width: 36px;
      height: 36px;
      display: grid;
      place-items: center;
      border-radius: 10px;
    }

    .toggle-btn:hover {
      background: rgba(255,255,255,0.06);
    }

    .nav {
      padding: 10px 8px;
      display: flex;
      flex-direction: column;
      gap: 6px;
      overflow: auto;
	  overflow-x: hidden;
    }

    .tab-btn {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 12px;
      background: transparent;
      border: none;
      color: var(--text);
      cursor: pointer;
      border-radius: 12px;
      text-align: left;
      position: relative;
    }

    .tab-btn:hover {
      background: var(--hover);
    }

    .tab-btn.active {
      background: rgba(59,130,246,0.14);
    }

    .tab-btn.active::before {
      content: "";
      position: absolute;
      left: 0;
      top: 10px;
      bottom: 10px;
      width: 4px;
      border-radius: 999px;
      background: var(--accent);
    }

    .icon {
      width: 22px;
      height: 22px;
      flex: 0 0 22px;
      color: var(--text);
      opacity: 0.95;
    }

    .label {
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      transition: opacity 120ms ease;
    }

    .sidebar.collapsed .label {
      opacity: 0;
      width: 0;
    }

    /* Tooltip when collapsed */
    .tab-btn[data-tooltip] {
      position: relative;
    }

    .sidebar.collapsed .tab-btn[data-tooltip]:hover::after {
      content: attr(data-tooltip);
      position: absolute;
      left: calc(var(--sidebar-collapsed) + 8px);
      top: 50%;
      transform: translateY(-50%);
      background: #0b1220;
      color: var(--text);
      padding: 8px 10px;
      border-radius: 10px;
      font-size: 13px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.25);
      border: 1px solid rgba(255,255,255,0.08);
      white-space: nowrap;
      z-index: 10;
    }

    /* Content */
    .content {
      flex: 1;
      height: 100vh;
      background: #f3f4f6;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      display: none;
      background: white;
	  transform: scale(1);
	  transform-origin: top left;
	  width: 100%;
	  height: 100%;
    }

    iframe.active {
      display: block;
    }

	iframe#newWallet {
      transform: scale(0.9);
      transform-origin: top left;
      width: 111.11%;
      height: 111.11%;
    }

	iframe#sign {
      transform: scale(1.06);
      transform-origin: top left;
      width: 94.34%;
      height: 94.34%;
    }

	iframe#diceware {
      transform: scale(1.06);
      transform-origin: top left;
      width: 94.34%;
      height: 94.34%;
    }

	iframe#keystoreTool {
      transform: scale(0.8);
      transform-origin: top left;
      width: 125%;
      height: 125%;
    }

	.nav-divider{
      height: 1px;
      margin: 6px 12px;
      background: rgba(255,255,255,0.08);
      flex-shrink: 0;
    }

    /* Home panel */
    .home {
      display: none;
      height: 100%;
      padding: 28px;
    }

    .home.active {
      display: block;
    }

    .home h1 {
      margin: 4px 0 12px 0;
      font-size: 20px;
      color: #111827;
	  text-align: center;
    }

    .home h2 {
      margin: 0 0 30px 0;
      font-size: 14px;
      color: #374151;
	  line-height: 1.4;
	  text-align: center;
	  font-weight: 500;
    }

    .home p {
      margin: 0 0 18px 0;
      color: #374151;
      max-width: 860px;
      line-height: 1.4;
	  text-align: center;
    }

    .home-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(280px, 1fr));
      gap: 24px;

      /* Center the grid container */
      max-width: 600px;
      margin: 0 auto;
    }

    .home-card {
      background: #ffffff;
      border: 1px solid rgba(17, 24, 39, 0.08);
      border-radius: 16px;
	  max-width:300px;
	  min-height: 100px;
      display: flex;
      flex-direction: column;
      padding: 14px 14px 12px 14px;
      cursor: pointer;
	  justify-self: center;
	  width: 100%;
      text-align: left;
      transition: transform 120ms ease, box-shadow 120ms ease, border-color 120ms ease;
      position: relative;
      overflow: hidden;
    }

    .home-card:hover {
      transform: translateY(-1px);
      box-shadow: 0 16px 40px rgba(0,0,0,0.10);
      border-color: rgba(59, 130, 246, 0.45);
    }

    .home-card-top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .home-card-title {
      font-weight: 700;
      color: #111827;
      font-size: 14px;
      margin: 0;
    }

    .home-card-badge {
      font-size: 12px;
      color: #1f2937;
      background: rgba(59, 130, 246, 0.12);
      border: 1px solid rgba(59, 130, 246, 0.20);
      padding: 4px 8px;
      border-radius: 999px;
      flex-shrink: 0;
    }

    .home-card-desc {
      margin: 10px 0 0 0;
      color: #4b5563;
      font-size: 13px;
      line-height: 1.35;
      max-height: 0;
      opacity: 0;
      transition: max-height 160ms ease, opacity 160ms ease;
    }

    .home-card:hover .home-card-desc {
      max-height: 120px;
      opacity: 1;
    }

    .home-card-cta {
      margin-top: 12px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      font-weight: 600;
      color: #357CBA;
    }

    .home-card-cta svg {
      width: 16px;
      height: 16px;
    }

	.home-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr)); /* allow columns to actually shrink */
      gap: 24px;
      max-width: 600px;
      margin: 0 auto;
    }

    .home-card {
      width: 100%;
      max-width: 300px;
      justify-self: center;
      box-sizing: border-box;
    }

    /* Collapse to 1 column on small screens */
    @media (max-width: 640px) {
      .home-grid {
        grid-template-columns: 1fr;
        max-width: 360px;         /* optional: keep it visually tidy */
      }

      .home-card {
        max-width: 100%;          /* use available width on small screens */
      }

      .home {
        padding: 18px;            /* your existing rule */
      }
    }

    /* Make home look good when sidebar is collapsed */
    @media (max-width: 700px) {
      .home { padding: 18px; }
    }

	/* Sidebar footer action area */
    .sidebar-footer {
      margin-top: auto;                 /* pushes footer to bottom */
      padding: 10px 8px 12px 8px;
      border-top: 1px solid rgba(255,255,255,0.06);
      background: var(--bg);
    }

    .footer-btn {
      width: 100%;
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 12px;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.10);
      color: var(--text);
      cursor: pointer;
      border-radius: 12px;
      text-align: left;
    }

    .footer-btn:hover {
      background: rgba(255,255,255,0.08);
    }

    .footer-btn .icon {
      opacity: 0.95;
    }


    /* --------------------------------------------------
       Floating Virtual Keyboard (compact, does not affect layout)
    -------------------------------------------------- */
    .vk {
      position: fixed;
      right: 16px;
      bottom: 16px;
      width: min(800px, calc(100vw - 24px));
      background: rgba(17, 24, 39, 0.92);
      color: var(--text);
      border: 1px solid rgba(255,255,255,0.10);
      border-radius: 16px;
      box-shadow: 0 18px 50px rgba(0,0,0,0.35);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      z-index: 9999;
      user-select: none;
    }

    .vk.hidden { display: none; }

    .vk-header {
      height: 42px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 10px 0 12px;
      border-bottom: 1px solid rgba(255,255,255,0.08);
      cursor: move;
    }

    .vk-title {
      font-size: 16px;
      font-weight: 600;
      letter-spacing: 0.2px;
      opacity: 0.95;
    }

    .vk-actions {
      display: inline-flex;
      gap: 6px;
      cursor: default;
    }

    .vk-action {
      appearance: none;
      border: 0;
      width: 30px;
      height: 30px;
      border-radius: 10px;
      background: rgba(255,255,255,0.06);
      color: var(--text);
      cursor: pointer;
      display: grid;
      place-items: center;
    }

    .vk-action:hover { background: rgba(255,255,255,0.10); }

    .vk-body {
      padding: 10px;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .vk-row {
      display: flex;
      gap: 6px;
    }

    .vk-key {
      appearance: none;
      border: 1px solid rgba(255,255,255,0.10);
      background: rgba(255,255,255,0.06);
      color: var(--text);
      border-radius: 12px;
      height: 40px;
      flex: 1 1 0;
      min-width: 34px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      display: grid;
      place-items: center;
    }

    .vk-key:hover { background: rgba(255,255,255,0.10); }
    .vk-key:active { transform: translateY(1px); }

    .vk-key.wide { flex: 1.6 1 0; }
    .vk-key.wider { flex: 2.2 1 0; }
    .vk-key.space { flex: 5 1 0; }

    .vk-key.toggled {
      background: rgba(59,130,246,0.18);
      border-color: rgba(59,130,246,0.35);
    }

    .vk-minimized .vk-body { display: none; }


    /* Virtual keyboard toggle button in sidebar: no boxed background/border */
    #vkToggleBtn.footer-btn{
      background: transparent;
      border: none;
      box-shadow: none;
    }
    #vkToggleBtn.footer-btn:hover{
      background: rgba(255,255,255,0.06);
    }

    /* Scale the floating keyboard to be 25% smaller (i.e., 75% of original size) */
    .vk{
      --vk-scale: 0.72;
      transform: scale(var(--vk-scale));
      transform-origin: bottom right;
    }
    .vk-header{ touch-action: none; }
	
	/* keep fixed anchor; drag with translate; keep scale */
    .vk{
      right:16px;
      bottom:16px;
      left:auto;
      top:auto;

      /* drag offsets (in screen px) */
      --vk-x: 0px;
      --vk-y: 0px;

      /* IMPORTANT: translate first, then scale */
      transform: translate(var(--vk-x), var(--vk-y)) scale(0.72);
      transform-origin: bottom right;
      will-change: transform;
    }

</style>
</head>
<body>
<aside class="sidebar" id="sidebar">
<div class="sidebar-header">
<div class="brand" title="Merged Wallet Tool">
<div class="brand-title" id="brandTitle">M&thinsp;E&thinsp;T&thinsp;A&thinsp;S&thinsp;T&thinsp;R&thinsp;E&thinsp;A&thinsp;M</div>
</div>
<button class="toggle-btn" id="toggleBtn" title="Collapse/Expand">
<!-- hamburger/chevron-ish -->
<svg aria-hidden="true" class="icon" fill="none" viewbox="0 0 24 24">
<path d="M6 7h12M6 12h12M6 17h12" stroke="currentColor" stroke-linecap="round" stroke-width="1.8"></path>
</svg>
</button>
</div>

<nav class="nav">
<button class="tab-btn active" data-tab="home" data-tooltip="Home" onclick="openTab('home', this)">
<svg aria-hidden="true" class="icon" fill="none" viewbox="0 0 24 24">
<path d="M4 11.2 12 4l8 7.2V20a1.5 1.5 0 0 1-1.5 1.5H5.5A1.5 1.5 0 0 1 4 20v-8.8Z" stroke="currentColor" stroke-linejoin="round" stroke-width="1.8"></path>
<path d="M9.5 21.5v-6.2a1.5 1.5 0 0 1 1.5-1.5h2a1.5 1.5 0 0 1 1.5 1.5v6.2" stroke="currentColor" stroke-linecap="round" stroke-width="1.8"></path>
</svg>
<span class="label">Home</span>
</button>

<div class="nav-divider"></div>

<button class="tab-btn" data-tab="newWallet" data-tooltip="New Wallet" onclick="openTab('newWallet', this)">
<svg aria-hidden="true" class="icon" fill="none" viewbox="0 0 24 24">
<path d="M3 7.5A3.5 3.5 0 0 1 6.5 4h11A2.5 2.5 0 0 1 20 6.5v11A2.5 2.5 0 0 1 17.5 20h-11A3.5 3.5 0 0 1 3 16.5v-9Z" stroke="currentColor" stroke-width="1.8"></path>
<path d="M12 8v8M8 12h8" stroke="currentColor" stroke-linecap="round" stroke-width="1.8"></path>
</svg>
<span class="label">New Wallet</span>
</button>

<!-- NEW: Dice Roll & Coin Flip (must be below New Wallet) -->
<button class="tab-btn" data-tab="diceware" data-tooltip="Dice Roll &amp; Coin Flip" onclick="openTab('diceware', this)">
<!-- dice icon -->
<svg aria-hidden="true" class="icon" fill="none" viewBox="0 0 24 24">
  <path d="M7 4h10a3 3 0 0 1 3 3v10a3 3 0 0 1-3 3H7a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3Z"
        stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"/>
  <circle cx="9" cy="9" r="1" fill="currentColor"></circle>
  <circle cx="15" cy="15" r="1" fill="currentColor"></circle>
  <circle cx="15" cy="9" r="1" fill="currentColor"></circle>
  <circle cx="9" cy="15" r="1" fill="currentColor"></circle>
</svg>
<span class="label">Dice Roll &amp; Coin Flip</span>
</button>

<button class="tab-btn" data-tab="keystoreTool" data-tooltip="Keystore Tool" onclick="openTab('keystoreTool', this)">
<!-- key icon -->
<svg aria-hidden="true" class="icon" fill="none" viewbox="0 0 24 24">
<circle cx="8.5" cy="11.5" r="3.5" stroke="currentColor" stroke-width="1.8"></circle>
<path d="M12 11.5h9M18 11.5v3M16 11.5v2" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path>
</svg>
<span class="label">Keystore Tool</span>
</button>

<button class="tab-btn" data-tab="connect" data-tooltip="Connect Wallet" onclick="openTab('connect', this)">
<svg aria-hidden="true" class="icon" fill="none" viewbox="0 0 24 24">
<path d="M10 13a5 5 0 0 1 0-7l1.2-1.2a5 5 0 0 1 7 7L17 13" stroke="currentColor" stroke-linecap="round" stroke-width="1.8"></path>
<path d="M14 11a5 5 0 0 1 0 7L12.8 19.2a5 5 0 1 1-7-7L7 11" stroke="currentColor" stroke-linecap="round" stroke-width="1.8"></path>
</svg>
<span class="label">Connect Wallet</span>
</button>

<button class="tab-btn" data-tab="sign" data-tooltip="Sign Transaction" onclick="openTab('sign', this)">
<!-- QR-code icon -->
<svg aria-hidden="true" class="icon" fill="none" viewbox="0 0 24 24">
<path d="M4 4h7v7H4V4Zm2 2v3h3V6H6Z" fill="currentColor"></path>
<path d="M13 4h7v7h-7V4Zm2 2v3h3V6h-3Z" fill="currentColor"></path>
<path d="M4 13h7v7H4v-7Zm2 2v3h3v-3H6Z" fill="currentColor"></path>
<path d="M13 13h2v2h-2v-2Zm4 0h3v3h-3v-3Zm-2 4h2v3h-2v-3Zm4 2h1v1h-1v-1Zm-2 1h3v1h-3v-1Z" fill="currentColor"></path>
</svg>
<span class="label">Sign Transaction</span>
</button>

<!-- NEW: Info (must be below Sign Transaction) -->
<button class="tab-btn" data-tab="info" data-tooltip="Info" onclick="openTab('info', this)">
<!-- info icon -->
<svg aria-hidden="true" class="icon" fill="none" viewBox="0 0 24 24">
  <path d="M12 22a10 10 0 1 0 0-20 10 10 0 0 0 0 20Z" stroke="currentColor" stroke-width="1.8"/>
  <path d="M12 10.5v6" stroke="currentColor" stroke-width="1.8" stroke-linecap="round"/>
  <circle cx="12" cy="7.5" r="1" fill="currentColor"></circle>
</svg>
<span class="label">Info</span>
</button>

</nav>

<div class="sidebar-footer">
  
  <button class="footer-btn" id="vkToggleBtn" type="button" data-tooltip="Virtual Keyboard">
    <svg aria-hidden="true" class="icon" fill="none" viewBox="0 0 24 24">
      <path d="M4 7a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7Z"
            stroke="currentColor" stroke-width="1.8" stroke-linejoin="round"></path>
      <path d="M7 10h2M11 10h2M15 10h2M7 13h2M11 13h2M15 13h2M7 16h10"
            stroke="currentColor" stroke-width="1.8" stroke-linecap="round"></path>
    </svg>
    <span class="label">Keyboard</span>
  </button>
<button class="footer-btn" type="button" onclick="clearAndClose()" data-tooltip="Clear & Close">
<svg aria-hidden="true" class="icon" fill="none" viewBox="0 0 24 24">
  <!-- Door -->
  <path
    d="M4 4h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4"
    stroke="currentColor"
    stroke-width="1.8"
    stroke-linecap="round"
    stroke-linejoin="round"
  />
  <!-- Arrow (log out) -->
  <path
    d="M10 12h10m0 0-3-3m3 3-3 3"
    stroke="currentColor"
    stroke-width="1.8"
    stroke-linecap="round"
    stroke-linejoin="round"
  />
</svg>

    <span class="label">Exit</span>
  </button>
</div>

</aside>

<main class="content">
  <div class="home tab-content active" id="home">
    <h1>M&thinsp;E&thinsp;T&thinsp;A&thinsp;S&thinsp;T&thinsp;R&thinsp;E&thinsp;A&thinsp;M</h1>
    <h2>A solution for creating Ethereum wallets and securely signing transactions offline</h2>

    <!-- Home tiles (order matches sidebar; 6 tiles = 3 rows x 2 columns) -->
    <div class="home-grid">

      <button class="home-card" onclick="openTab('newWallet')" type="button">
        <div class="home-card-top">
          <div class="home-card-title">New Wallet</div>
          <div class="home-card-badge">Create</div>
        </div>
        <div class="home-card-desc">
          Create a new Ethereum wallet with 12/15/18/21/24 word seedphrase, an optional passphrase and custom derivation paths. Save wallet as an encrypted keystore file.
        </div>
        <div class="home-card-cta">
          Open
          <svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path>
          </svg>
        </div>
      </button>

      <!-- NEW: Dice Roll & Coin Flip (2nd tile) -->
      <button class="home-card" onclick="openTab('diceware')" type="button">
        <div class="home-card-top">
          <div class="home-card-title">Dice Roll &amp; Coin Flip</div>
          <div class="home-card-badge">Seed Phrase</div>
        </div>
        <div class="home-card-desc">
          Create a seed phrase using 5 dice rolls and a coin flip. Simulate the dice rolls or roll real dice. Find the final checksum word of a generated seed phrase.
        </div>
        <div class="home-card-cta">
          Open
          <svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path>
          </svg>
        </div>
      </button>

      <button class="home-card" onclick="openTab('keystoreTool')" type="button">
        <div class="home-card-top">
          <div class="home-card-title">Keystore Tool</div>
          <div class="home-card-badge">Encrypt/Decrypt</div>
        </div>
        <div class="home-card-desc">
          Work with .jsos keystore files. Encrypt private key to create a keystore or decrypt a keystore to access private keys. Use encrypted keystore for securely signing transactions.
        </div>
        <div class="home-card-cta">
          Open
          <svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path>
          </svg>
        </div>
      </button>

      <button class="home-card" onclick="openTab('connect')" type="button">
        <div class="home-card-top">
          <div class="home-card-title">Connect Wallet</div>
          <div class="home-card-badge">Metamask/Rabby</div>
        </div>
        <div class="home-card-desc">
          Connect any wallet to Metamask or Rabby as a hardware wallet. Use this tool to add a wallet to Metamask or Rabby for creating unsigned transactions.
        </div>
        <div class="home-card-cta">
          Open
          <svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path>
          </svg>
        </div>
      </button>

      <button class="home-card" onclick="openTab('sign')" type="button">
        <div class="home-card-top">
          <div class="home-card-title">Sign Transaction</div>
          <div class="home-card-badge">QR Workflow</div>
        </div>
        <div class="home-card-desc">
          Sign a transaction request QR code generated by Metamask/Rabby. Sign with keystore file, private key or mnemonic seedphrase. Scan the generated signed transaction QR with Metamask/Rabby to complete transaction.
        </div>
        <div class="home-card-cta">
          Open
          <svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path>
          </svg>
        </div>
      </button>

      <!-- NEW: Info (6th tile) -->
      <button class="home-card" onclick="openTab('info')" type="button">
        <div class="home-card-top">
          <div class="home-card-title">Info</div>
          <div class="home-card-badge">Docs</div>
        </div>
        <div class="home-card-desc">
          License, reference information, usage notes, and supporting details for METASTREAM.
        </div>
        <div class="home-card-cta">
          Open
          <svg aria-hidden="true" fill="none" viewbox="0 0 24 24">
            <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1.8"></path>
          </svg>
        </div>
      </button>

    </div>
  </div>

  <iframe class="tab-content" id="newWallet" src="tabs/new-wallet.html"></iframe>
  <iframe class="tab-content" id="diceware" src="tabs/diceware.html"></iframe>
  <iframe class="tab-content" id="keystoreTool" src="tabs/keystore-tool.html"></iframe>
  <iframe class="tab-content" id="connect" src="tabs/connect.html"></iframe>
  <iframe class="tab-content" id="sign" src="tabs/sign.html"></iframe>
  <iframe class="tab-content" id="info" src="tabs/info.html"></iframe>

</main>


<!-- Floating Virtual Keyboard -->
<div class="vk hidden" id="vk" aria-hidden="true">
  <div class="vk-header" id="vkHeader">
    <div class="vk-title">Virtual Keyboard</div>
    <div class="vk-actions">
      <button class="vk-action" id="vkMinBtn" type="button" title="Minimize/Expand" aria-label="Minimize/Expand">
        <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M6 12h12" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
      <button class="vk-action" id="vkCloseBtn" type="button" title="Close" aria-label="Close">
        <svg aria-hidden="true" width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M6 6l12 12M18 6 6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <div class="vk-body" id="vkBody">
    <div class="vk-row">
      <button class="vk-key" data-normal="`" data-shift="~" type="button">`</button>
      <button class="vk-key" data-normal="1" data-shift="!" type="button">1</button>
      <button class="vk-key" data-normal="2" data-shift="@" type="button">2</button>
      <button class="vk-key" data-normal="3" data-shift="#" type="button">3</button>
      <button class="vk-key" data-normal="4" data-shift="$" type="button">4</button>
      <button class="vk-key" data-normal="5" data-shift="%" type="button">5</button>
      <button class="vk-key" data-normal="6" data-shift="^" type="button">6</button>
      <button class="vk-key" data-normal="7" data-shift="&amp;" type="button">7</button>
      <button class="vk-key" data-normal="8" data-shift="*" type="button">8</button>
      <button class="vk-key" data-normal="9" data-shift="(" type="button">9</button>
      <button class="vk-key" data-normal="0" data-shift=")" type="button">0</button>
      <button class="vk-key" data-normal="-" data-shift="_" type="button">-</button>
      <button class="vk-key" data-normal="=" data-shift="+" type="button">=</button>
      <button class="vk-key wider" data-action="backspace" type="button">Backspace</button>
    </div>

    <div class="vk-row">
      <button class="vk-key wide" data-action="tab" type="button">Tab</button>
      <button class="vk-key" data-letter="q" type="button">q</button>
      <button class="vk-key" data-letter="w" type="button">w</button>
      <button class="vk-key" data-letter="e" type="button">e</button>
      <button class="vk-key" data-letter="r" type="button">r</button>
      <button class="vk-key" data-letter="t" type="button">t</button>
      <button class="vk-key" data-letter="y" type="button">y</button>
      <button class="vk-key" data-letter="u" type="button">u</button>
      <button class="vk-key" data-letter="i" type="button">i</button>
      <button class="vk-key" data-letter="o" type="button">o</button>
      <button class="vk-key" data-letter="p" type="button">p</button>
      <button class="vk-key" data-normal="[" data-shift="{" type="button">[</button>
      <button class="vk-key" data-normal="]" data-shift="}" type="button">]</button>
      <button class="vk-key" data-normal="\\" data-shift="|" type="button">\</button>
    </div>

    <div class="vk-row">
      <button class="vk-key wider" data-action="caps" type="button">Caps</button>
      <button class="vk-key" data-letter="a" type="button">a</button>
      <button class="vk-key" data-letter="s" type="button">s</button>
      <button class="vk-key" data-letter="d" type="button">d</button>
      <button class="vk-key" data-letter="f" type="button">f</button>
      <button class="vk-key" data-letter="g" type="button">g</button>
      <button class="vk-key" data-letter="h" type="button">h</button>
      <button class="vk-key" data-letter="j" type="button">j</button>
      <button class="vk-key" data-letter="k" type="button">k</button>
      <button class="vk-key" data-letter="l" type="button">l</button>
      <button class="vk-key" data-normal=";" data-shift=":" type="button">;</button>
      <button class="vk-key" data-normal="'" data-shift="&quot;" type="button">'</button>
      <button class="vk-key wider" data-action="enter" type="button">Enter</button>
    </div>

    <div class="vk-row">
      <button class="vk-key wider" data-action="shift" type="button">Shift</button>
      <button class="vk-key" data-letter="z" type="button">z</button>
      <button class="vk-key" data-letter="x" type="button">x</button>
      <button class="vk-key" data-letter="c" type="button">c</button>
      <button class="vk-key" data-letter="v" type="button">v</button>
      <button class="vk-key" data-letter="b" type="button">b</button>
      <button class="vk-key" data-letter="n" type="button">n</button>
      <button class="vk-key" data-letter="m" type="button">m</button>
      <button class="vk-key" data-normal="," data-shift="&lt;" type="button">,</button>
      <button class="vk-key" data-normal="." data-shift="&gt;" type="button">.</button>
      <button class="vk-key" data-normal="/" data-shift="?" type="button">/</button>
      <button class="vk-key wider" data-action="shift" type="button">Shift</button>
    </div>

    <div class="vk-row">
      <button class="vk-key wide" data-action="esc" type="button">Esc</button>
      <button class="vk-key wide" data-action="left" type="button">◀</button>
      <button class="vk-key space" data-action="space" type="button">Space</button>
      <button class="vk-key wide" data-action="right" type="button">▶</button>
      <button class="vk-key wide" data-action="del" type="button">Del</button>
    </div>
  </div>
</div>


<script>
  const sidebar = document.getElementById("sidebar");
  const toggleBtn = document.getElementById("toggleBtn");

  toggleBtn.addEventListener("click", () => {
    sidebar.classList.toggle("collapsed");
    // persist state
    localStorage.setItem(
      "sidebarCollapsed",
      sidebar.classList.contains("collapsed") ? "1" : "0"
    );
  });

  // restore persisted state — default is COLLAPSED
  const collapsedState = localStorage.getItem("sidebarCollapsed");

  // If nothing is stored yet, default to collapsed
  if (collapsedState === null || collapsedState === "1") {
    sidebar.classList.add("collapsed");
  }

  function openTab(tabId, btn) {
    // Allow calls without passing a sidebar button (e.g., from the Home tiles)
    if (!btn) {
      btn = document.querySelector(`.tab-btn[data-tab="${tabId}"]`);
    }

    document.querySelectorAll(".tab-content").forEach(frame =>
      frame.classList.remove("active")
    );
    document.querySelectorAll(".tab-btn").forEach(b =>
      b.classList.remove("active")
    );

    const target = document.getElementById(tabId);
    if (target) target.classList.add("active");
    if (btn) btn.classList.add("active");
  }

  // --------------------------------------------------
  // Clear everything and attempt to close the window
  // --------------------------------------------------
  function clearAndClose() {
    // 1) Reset UI to a neutral state (Home if it exists)
    if (document.getElementById("home")) {
      openTab("home");
    }

    // 2) Clear persisted storage
    try { localStorage.clear(); } catch (e) {}
    try { sessionStorage.clear(); } catch (e) {}

    // 3) Unload all iframe contents
    document.querySelectorAll("iframe.tab-content").forEach(frame => {
      frame.src = "about:blank";
      frame.classList.remove("active");
    });

    // 4) Attempt to close the window
    fetch("/api/shutdown", { method: "POST" }).catch(() => {});
    window.close();

    // 5) Fallback if browser blocks closing
    setTimeout(() => {
      try {
        window.location.replace("about:blank");
      } catch (e) {
        document.documentElement.innerHTML = "";
      }
    }, 150);
  }

  // --------------------------------------------------
  // Floating Virtual Keyboard
  // - Types into focused inputs inside the active iframe
  // - Shift/Caps + common US keyboard symbols
  // - Floating overlay (does not affect tab layout)
  // --------------------------------------------------
  const vkToggleBtn = document.getElementById("vkToggleBtn");
  const vk = document.getElementById("vk");
  const vkHeader = document.getElementById("vkHeader");
  const vkCloseBtn = document.getElementById("vkCloseBtn");
  const vkMinBtn = document.getElementById("vkMinBtn");

  let vkVisible = false;
  let vkShift = false;   // momentary
  let vkCaps = false;    // toggle
  let vkMinimized = false;

  let vkActiveEl = null;       // element within an iframe
  let vkActiveFrame = null;    // iframe element hosting vkActiveEl

  function isTextTarget(el) {
    if (!el) return false;

    // contenteditable
    if (el.isContentEditable) return true;

    const tag = (el.tagName || "").toLowerCase();
    if (tag === "textarea") return true;

    if (tag === "input") {
      const type = (el.getAttribute("type") || "text").toLowerCase();
      // exclude non-textual input types
      const excluded = new Set([
        "button", "submit", "reset", "checkbox", "radio",
        "file", "range", "color", "date", "datetime-local",
        "month", "week", "time", "image"
      ]);
      return !excluded.has(type);
    }
    return false;
  }

  function wireFrameFocusTracking(frame) {
    let doc;
    try { doc = frame.contentDocument; } catch (e) { return; }
    if (!doc || doc.__vkWired) return;

    doc.__vkWired = true;

    // Track focus for inputs/textareas/contenteditable within the iframe
    doc.addEventListener("focusin", (ev) => {
      const t = ev.target;
      if (isTextTarget(t)) {
        vkActiveEl = t;
        vkActiveFrame = frame;
      }
    }, true);

    // Also track on mouse down (some UIs do not focus until mouseup)
    doc.addEventListener("mousedown", (ev) => {
      const t = ev.target;
      if (isTextTarget(t)) {
        vkActiveEl = t;
        vkActiveFrame = frame;
      }
    }, true);
  }

  // Wire all iframes on load
  document.querySelectorAll("iframe.tab-content").forEach((frame) => {
    frame.addEventListener("load", () => wireFrameFocusTracking(frame));
    // Attempt immediate wire if already loaded
    try {
      if (frame.contentDocument && frame.contentDocument.readyState === "complete") {
        wireFrameFocusTracking(frame);
      }
    } catch (e) {}
  });

  function getActiveDoc() {
    if (vkActiveFrame) {
      try { return vkActiveFrame.contentDocument; } catch (e) { return null; }
    }
    const activeFrame = document.querySelector("iframe.tab-content.active");
    if (!activeFrame) return null;
    try { return activeFrame.contentDocument; } catch (e) { return null; }
  }

  function dispatchInputEvents(el) {
    try {
      el.dispatchEvent(new Event("input", { bubbles: true }));
      el.dispatchEvent(new Event("change", { bubbles: true }));
    } catch (e) {}
  }

  function focusFallbackTarget() {
    // If we don't have a tracked target yet, try to focus the first visible input in the active iframe
    const doc = getActiveDoc();
    if (!doc) return null;

    const candidates = Array.from(doc.querySelectorAll("input, textarea, [contenteditable=''], [contenteditable='true']"))
      .filter(isTextTarget)
      .filter(el => !el.disabled && el.tabIndex !== -1);

    if (candidates.length) {
      try { candidates[0].focus(); } catch (e) {}
      vkActiveEl = candidates[0];
      vkActiveFrame = document.querySelector("iframe.tab-content.active");
      return vkActiveEl;
    }
    return null;
  }

  function insertText(text) {
    let el = vkActiveEl;
    if (!el || !isTextTarget(el)) el = focusFallbackTarget();
    if (!el || !isTextTarget(el)) return;

    // Ensure focus stays where we type
    try { el.focus(); } catch (e) {}

    const doc = getActiveDoc();

    if (el.isContentEditable) {
      try {
        // execCommand is deprecated but remains broadly supported for this purpose
        doc.execCommand("insertText", false, text);
      } catch (e) {}
      return;
    }

    // input/textarea
    try {
      const start = el.selectionStart ?? el.value.length;
      const end = el.selectionEnd ?? el.value.length;
      if (typeof el.setRangeText === "function") {
        el.setRangeText(text, start, end, "end");
      } else {
        const v = el.value || "";
        el.value = v.slice(0, start) + text + v.slice(end);
        const pos = start + text.length;
        el.selectionStart = el.selectionEnd = pos;
      }
      dispatchInputEvents(el);
    } catch (e) {}
  }

  function backspace() {
    let el = vkActiveEl;
    if (!el || !isTextTarget(el)) el = focusFallbackTarget();
    if (!el || !isTextTarget(el)) return;

    try { el.focus(); } catch (e) {}

    const doc = getActiveDoc();

    if (el.isContentEditable) {
      try { doc.execCommand("delete", false, null); } catch (e) {}
      return;
    }

    try {
      const start = el.selectionStart ?? 0;
      const end = el.selectionEnd ?? 0;

      if (start !== end) {
        el.setRangeText("", start, end, "end");
      } else if (start > 0) {
        el.setRangeText("", start - 1, start, "end");
      }
      dispatchInputEvents(el);
    } catch (e) {}
  }

  function delForward() {
    let el = vkActiveEl;
    if (!el || !isTextTarget(el)) el = focusFallbackTarget();
    if (!el || !isTextTarget(el)) return;

    try { el.focus(); } catch (e) {}

    const doc = getActiveDoc();

    if (el.isContentEditable) {
      try { doc.execCommand("forwardDelete", false, null); } catch (e) {}
      return;
    }

    try {
      const start = el.selectionStart ?? 0;
      const end = el.selectionEnd ?? 0;
      const vlen = (el.value || "").length;

      if (start !== end) {
        el.setRangeText("", start, end, "end");
      } else if (start < vlen) {
        el.setRangeText("", start, start + 1, "end");
      }
      dispatchInputEvents(el);
    } catch (e) {}
  }

  function moveCaret(delta) {
    let el = vkActiveEl;
    if (!el || !isTextTarget(el)) el = focusFallbackTarget();
    if (!el || !isTextTarget(el)) return;

    try { el.focus(); } catch (e) {}

    if (el.isContentEditable) return; // keep simple

    try {
      const pos = el.selectionStart ?? 0;
      const next = Math.max(0, pos + delta);
      el.selectionStart = el.selectionEnd = next;
    } catch (e) {}
  }

  function focusNext(direction = 1) {
    const doc = getActiveDoc();
    if (!doc) return;

    const focusables = Array.from(doc.querySelectorAll("input, textarea, button, select, a[href], [tabindex]"))
      .filter(el => !el.disabled && el.tabIndex !== -1);

    if (!focusables.length) return;

    let idx = Math.max(0, focusables.indexOf(vkActiveEl));
    idx = (idx + direction + focusables.length) % focusables.length;

    try { focusables[idx].focus(); } catch (e) {}
    if (isTextTarget(focusables[idx])) {
      vkActiveEl = focusables[idx];
      vkActiveFrame = document.querySelector("iframe.tab-content.active");
    }
  }

  function updateKeyLabels() {
    const letterUpper = vkCaps ^ vkShift;

    vk.querySelectorAll(".vk-key[data-letter]").forEach((btn) => {
      const base = btn.getAttribute("data-letter") || "";
      btn.textContent = letterUpper ? base.toUpperCase() : base.toLowerCase();
    });

    vk.querySelectorAll(".vk-key[data-normal]").forEach((btn) => {
      const normal = btn.getAttribute("data-normal") || "";
      const shifted = btn.getAttribute("data-shift") || normal;
      btn.textContent = vkShift ? shifted : normal;
    });

    // toggle styling
    vk.querySelectorAll(".vk-key[data-action='shift']").forEach(b => b.classList.toggle("toggled", vkShift));
    vk.querySelectorAll(".vk-key[data-action='caps']").forEach(b => b.classList.toggle("toggled", vkCaps));
  }

  function showKeyboard() {
    vkVisible = true;
    vk.classList.remove("hidden");
    vk.setAttribute("aria-hidden", "false");
    updateKeyLabels();
  }

  function hideKeyboard() {
    vkVisible = false;
    vk.classList.add("hidden");
    vk.setAttribute("aria-hidden", "true");
    vkShift = false;
    updateKeyLabels();
  }

  function toggleKeyboard() {
    if (vkVisible) hideKeyboard();
    else showKeyboard();
  }

  if (vkToggleBtn) {
    vkToggleBtn.addEventListener("click", toggleKeyboard);
  }
  if (vkCloseBtn) vkCloseBtn.addEventListener("click", hideKeyboard);

  if (vkMinBtn) {
    vkMinBtn.addEventListener("click", () => {
      vkMinimized = !vkMinimized;
      vk.classList.toggle("vk-minimized", vkMinimized);
    });
  }

  // Key click handler
  vk.addEventListener("click", (ev) => {
    const btn = ev.target.closest(".vk-key");
    if (!btn) return;

    const action = btn.getAttribute("data-action");
    if (action) {
      switch (action) {
        case "backspace": backspace(); break;
        case "del": delForward(); break;
        case "enter":
          // For textarea/contenteditable, insert newline; for input, trigger enter key events only
          if (vkActiveEl && (vkActiveEl.tagName || "").toLowerCase() === "textarea") insertText("\\n");
          else {
            // Try to dispatch Enter key events to the focused element
            try {
              const doc = getActiveDoc();
              const el = vkActiveEl || focusFallbackTarget();
              if (doc && el) {
                el.dispatchEvent(new KeyboardEvent("keydown", { key: "Enter", code: "Enter", bubbles: true }));
                el.dispatchEvent(new KeyboardEvent("keyup", { key: "Enter", code: "Enter", bubbles: true }));
              }
            } catch (e) {}
          }
          break;
        case "tab": focusNext(1); break;
        case "esc": hideKeyboard(); break;
        case "left": moveCaret(-1); break;
        case "right": moveCaret(1); break;
        case "space": insertText(" "); break;
        case "shift":
          vkShift = !vkShift;
          updateKeyLabels();
          break;
        case "caps":
          vkCaps = !vkCaps;
          updateKeyLabels();
          break;
      }
      return;
    }

    // Printable keys
    let text = "";
    if (btn.hasAttribute("data-letter")) {
      const base = btn.getAttribute("data-letter") || "";
      const upper = vkCaps ^ vkShift;
      text = upper ? base.toUpperCase() : base.toLowerCase();
    } else if (btn.hasAttribute("data-normal")) {
      const normal = btn.getAttribute("data-normal") || "";
      const shifted = btn.getAttribute("data-shift") || normal;
      text = vkShift ? shifted : normal;
      // HTML entities in attributes need decoding for insertion
      text = text
        .replaceAll("&amp;", "&")
        .replaceAll("&lt;", "<")
        .replaceAll("&gt;", ">")
        .replaceAll("&quot;", '"');
    }

    if (text) insertText(text);

    // Shift is momentary (unless Caps is on)
    if (vkShift && !btn.hasAttribute("data-action")) {
      vkShift = false;
      updateKeyLabels();
    }
  });

    (function enableDrag() {
      const scale = 0.72; // must match your CSS scale
      let dragging = false;
      let startX = 0, startY = 0;
      let startTX = 0, startTY = 0;
      let rafId = 0;
      let nextTX = 0, nextTY = 0;

      function getVarPx(name) {
        const v = getComputedStyle(vk).getPropertyValue(name).trim();
        return v.endsWith("px") ? parseFloat(v) : 0;
      }

      function apply() {
        rafId = 0;
        vk.style.setProperty("--vk-x", `${nextTX}px`);
        vk.style.setProperty("--vk-y", `${nextTY}px`);
      }

      function onDown(e) {
        if (e.target.closest(".vk-actions")) return;
        dragging = true;

        vkHeader.setPointerCapture(e.pointerId);

        startX = e.clientX;
        startY = e.clientY;

        startTX = getVarPx("--vk-x");
        startTY = getVarPx("--vk-y");

        nextTX = startTX;
        nextTY = startTY;
      }

      function onMove(e) {
        if (!dragging) return;

        // compensate for scale so drag matches cursor movement
        const dx = (e.clientX - startX) / scale;
        const dy = (e.clientY - startY) / scale;

        nextTX = startTX + dx;
        nextTY = startTY + dy;

        if (!rafId) rafId = requestAnimationFrame(apply);
      }

      function onUp(e) {
        dragging = false;
        try { vkHeader.releasePointerCapture(e.pointerId); } catch (_) {}
      }

      vkHeader.addEventListener("pointerdown", onDown);
      vkHeader.addEventListener("pointermove", onMove);
      vkHeader.addEventListener("pointerup", onUp);
      vkHeader.addEventListener("pointercancel", onUp);
    })();

  // Keep toggle button label state (optional)
  function syncVkButtonState() {
    if (!vkToggleBtn) return;
    vkToggleBtn.classList.toggle("active", vkVisible);
  }
  const _vkOrigShow = showKeyboard;
  const _vkOrigHide = hideKeyboard;
  showKeyboard = function() { _vkOrigShow(); syncVkButtonState(); };
  hideKeyboard = function() { _vkOrigHide(); syncVkButtonState(); };
  // --------------------------------------------------

</script>

</body>
</html>
